<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>üöÄ Drone Control Dashboard</title>
<style>
  body {
    margin: 0;
    font-family: 'Segoe UI', Roboto, sans-serif;
    background: #0f172a;
    color: #e2e8f0;
  }
  /* Header */
  header {
    background: #1e293b;
    padding: 20px;
    text-align: center;
    box-shadow: 0 6px 15px rgba(0,0,0,0.5);
  }
  header h1 {
    margin: 0;
    font-size: 30px;
    color: #38bdf8;
    letter-spacing: 1px;
    text-shadow: 0 0 8px #38bdf8;
  }
  /* Login Screen */
  #login-screen {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    height: calc(100vh - 80px);
    gap: 10px;
  }
  #login-screen input {
    padding: 10px;
    border-radius: 8px;
    border: none;
    width: 200px;
  }
  #login-screen button {
    padding: 10px 20px;
    border-radius: 8px;
    border: none;
    cursor: pointer;
    background: #38bdf8;
    color: #fff;
    font-weight: bold;
  }
  /* Container for services */
  #dashboard {
    display: none;
    grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
    gap: 30px;
    padding: 40px;
  }
  .card {
    background: #1e293b;
    border-radius: 18px;
    padding: 25px;
    box-shadow: 0 10px 25px rgba(0,0,0,0.5);
    transition: transform 0.3s, box-shadow 0.3s;
    position: relative;
  }
  .card:hover {
    transform: translateY(-8px);
    box-shadow: 0 15px 35px rgba(0,0,0,0.7);
  }
  .card h2 {
    margin: 0 0 20px 0;
    font-size: 24px;
    display: flex;
    align-items: center;
    gap: 10px;
    color: #f8fafc;
  }
  .btn-group { margin-top: 15px; }
  .btn {
    padding: 12px 20px;
    border: none;
    border-radius: 12px;
    cursor: pointer;
    font-size: 14px;
    font-weight: bold;
    transition: 0.3s;
    margin-right: 15px;
    box-shadow: 0 4px 10px rgba(0,0,0,0.3);
  }
  .start { background: #16a34a; color: white; }
  .start:hover:enabled { background: #22c55e; box-shadow: 0 6px 18px rgba(34,197,94,0.5); }
  .stop { background: #dc2626; color: white; }
  .stop:hover:enabled { background: #ef4444; box-shadow: 0 6px 18px rgba(239,68,68,0.5); }
  .btn:disabled { opacity: 0.5; cursor: not-allowed; }
  .status, .uptime {
    margin-top: 15px;
    padding: 10px 16px;
    border-radius: 14px;
    display: inline-flex;
    align-items: center;
    font-weight: bold;
    gap: 10px;
    font-size: 15px;
    transition: 0.3s;
  }
  .dot {
    height: 14px;
    width: 14px;
    border-radius: 50%;
    display: inline-block;
    box-shadow: 0 0 6px #000;
    animation: pulse 2s infinite;
  }
  @keyframes pulse {
    0%, 100% { transform: scale(1); opacity: 1; }
    50% { transform: scale(1.3); opacity: 0.7; }
  }
  .running { background: rgba(34,197,94,0.15); color: #22c55e; }
  .running .dot { background: #22c55e; box-shadow: 0 0 12px #22c55e; }
  .stopped { background: rgba(239,68,68,0.15); color: #ef4444; }
  .stopped .dot { background: #ef4444; box-shadow: 0 0 12px #ef4444; }
  .unknown { background: rgba(148,163,184,0.2); color: #94a3b8; }
  .unknown .dot { background: #94a3b8; box-shadow: 0 0 8px #94a3b8; }
  .uptime { font-size: 14px; color: #f1f5f9; background: rgba(255,255,255,0.05); font-weight: 500; }
  footer {
    text-align: center;
    padding: 20px;
    font-size: 13px;
    color: #64748b;
    border-top: 1px solid rgba(255,255,255,0.1);
  }
  /* Notification container */
  #notifications {
    position: fixed;
    top: 20px;
    right: 20px;
    z-index: 9999;
    display: flex;
    flex-direction: column;
  }
</style>
</head>
<body>

<header>
  <h1>üöÄ Drone Control Dashboard</h1>
</header>

<!-- Login Screen -->
<div id="login-screen">
  <input type="text" id="username" placeholder="Username">
  <input type="password" id="password" placeholder="Password">
  <button onclick="login()">Login</button>
</div>

<!-- Dashboard -->
<div id="dashboard" class="container">
  <!-- Notifications -->
  <div id="notifications"></div>

  <!-- EoN Service -->
  <div class="card">
    <h2>üì° EoN Service (5001)</h2>
    <div class="btn-group">
      <button id="eon-start" class="btn start" onclick="sendCommand('http://localhost:5001/start', 'eon')">‚ñ∂ Start</button>
      <button id="eon-stop" class="btn stop" onclick="sendCommand('http://localhost:5001/stop', 'eon')">‚èπ Stop</button>
    </div>
    <div id="eon-status" class="status unknown"><span class="dot"></span> Checking...</div>
    <div id="eon-uptime" class="uptime">‚è± Uptime: 00:00:00</div>
  </div>

  <!-- MAVLINK Service -->
  <div class="card">
    <h2>üõ∞ MAVLINK Service (5002)</h2>
    <div class="btn-group">
      <button id="mav-start" class="btn start" onclick="sendCommand('http://localhost:5002/start', 'mav')">‚ñ∂ Start</button>
      <button id="mav-stop" class="btn stop" onclick="sendCommand('http://localhost:5002/stop', 'mav')">‚èπ Stop</button>
    </div>
    <div id="mav-status" class="status unknown"><span class="dot"></span> Checking...</div>
    <div id="mav-uptime" class="uptime">‚è± Uptime: 00:00:00</div>
  </div>
</div>

<footer>
  Drone Management Dashboard ‚Ä¢ Powered by Flask + Grafana Embed
</footer>

<script>
let uptimeStart = { eon: null, mav: null };

// Login
function login() {
  const user = document.getElementById("username").value;
  const pass = document.getElementById("password").value;
  if (user === "admin" && pass === "admin") {
    document.getElementById("login-screen").style.display = "none";
    document.getElementById("dashboard").style.display = "grid";
  } else {
    alert("‚ùå Invalid credentials");
  }
  return false;
}

// Notification
function showNotification(message, type="info") {
  const container = document.getElementById("notifications");
  const notif = document.createElement("div");
  notif.textContent = message;
  notif.style.background = type === "error" ? "#dc2626" : "#16a34a";
  notif.style.color = "white";
  notif.style.padding = "10px 16px";
  notif.style.borderRadius = "8px";
  notif.style.marginTop = "10px";
  notif.style.boxShadow = "0 4px 12px rgba(0,0,0,0.4)";
  notif.style.fontWeight = "bold";
  notif.style.minWidth = "200px";
  notif.style.transition = "all 0.5s ease";

  container.appendChild(notif);
  setTimeout(() => {
    notif.style.opacity = 0;
    notif.style.transform = "translateX(100%)";
    setTimeout(() => container.removeChild(notif), 500);
  }, 3000);
}

async function sendCommand(url, service) {
  const el = document.getElementById(service + "-status");
  try {
    el.innerHTML = `<span class="dot"></span> Processing...`;
    el.className = "status unknown";

    const res = await fetch(url, { method: 'POST' });
    if (!res.ok) throw new Error("Request failed");

    const data = await res.json();
    updateStatus(service, data.status);

    if (data.status.toLowerCase().includes("running") || data.status.toLowerCase().includes("started")) {
      showNotification(`‚úÖ ${service.toUpperCase()} Started`, "info");
    } else if (data.status.toLowerCase().includes("stopped")) {
      showNotification(`‚ö†Ô∏è ${service.toUpperCase()} Stopped`, "error");
    }

  } catch (err) {
    console.error(err);
    updateStatus(service, "stopped");
    showNotification(`${service.toUpperCase()} - Failed to reach server!`, "error");
  }
}

function updateStatus(service, status) {
  const el = document.getElementById(service + "-status");
  const startBtn = document.getElementById(service + "-start");
  const stopBtn = document.getElementById(service + "-stop");
  const uptimeEl = document.getElementById(service + "-uptime");

  if (status.toLowerCase().includes("running") || status.toLowerCase().includes("started")) {
    el.innerHTML = `<span class="dot"></span> Running`;
    el.className = "status running";
    startBtn.disabled = true;
    stopBtn.disabled = false;
    if (!uptimeStart[service]) uptimeStart[service] = Date.now();
  } else if (status.toLowerCase().includes("stopped")) {
    el.innerHTML = `<span class="dot"></span> Stopped`;
    el.className = "status stopped";
    startBtn.disabled = false;
    stopBtn.disabled = true;
    uptimeStart[service] = null;
    uptimeEl.textContent = "‚è± Uptime: 00:00:00";
  } else {
    el.innerHTML = `<span class="dot"></span> Unknown`;
    el.className = "status unknown";
    startBtn.disabled = false;
    stopBtn.disabled = false;
    uptimeStart[service] = null;
    uptimeEl.textContent = "‚è± Uptime: 00:00:00";
  }
}

function formatTime(ms) {
  const totalSeconds = Math.floor(ms / 1000);
  const hrs = String(Math.floor(totalSeconds / 3600)).padStart(2, '0');
  const mins = String(Math.floor((totalSeconds % 3600) / 60)).padStart(2, '0');
  const secs = String(totalSeconds % 60).padStart(2, '0');
  return `${hrs}:${mins}:${secs}`;
}

function updateUptime() {
  for (const service of ["eon","mav"]) {
    const uptimeEl = document.getElementById(service + "-uptime");
    if (uptimeStart[service]) {
      uptimeEl.textContent = "‚è± Uptime: " + formatTime(Date.now() - uptimeStart[service]);
    }
  }
}

async function checkStatus() {
  try {
    const eonRes = await fetch("http://localhost:5001/uiStatus");
    updateStatus("eon", eonRes.ok ? (await eonRes.json()).status : "stopped");
  } catch { updateStatus("eon", "stopped"); }

  try {
    const mavRes = await fetch("http://localhost:5002/uiStatus");
    updateStatus("mav", mavRes.ok ? (await mavRes.json()).status : "stopped");
  } catch { updateStatus("mav", "stopped"); }
}

setInterval(checkStatus, 5000);
setInterval(updateUptime, 1000);
checkStatus();

</script>
</body>
</html>

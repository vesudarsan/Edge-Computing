<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>üöÄ Drone Control Panel</title>
<style>
  body {
    margin: 0;
    font-family: 'Segoe UI', Roboto, sans-serif;
    background: #0f172a;
    color: #e2e8f0;
  }
  header {
    background: #1e293b;
    padding: 20px;
    text-align: center;
    box-shadow: 0 6px 15px rgba(0,0,0,0.5);
  }
  header h1 {
    margin: 0;
    font-size: 28px;
    color: #38bdf8;
    text-shadow: 0 0 6px #38bdf8;
  }
  #dashboard {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
    gap: 30px;
    padding: 40px;
  }
  .card {
    background: #1e293b;
    border-radius: 16px;
    padding: 25px;
    box-shadow: 0 10px 25px rgba(0,0,0,0.5);
    transition: transform 0.3s, box-shadow 0.3s;
  }
  .card:hover {
    transform: translateY(-6px);
    box-shadow: 0 15px 35px rgba(0,0,0,0.7);
  }
  .card h2 {
    margin: 0 0 20px 0;
    font-size: 22px;
    color: #f8fafc;
  }
  .btn-group { margin-top: 15px; }
  .btn {
    padding: 10px 18px;
    border: none;
    border-radius: 10px;
    cursor: pointer;
    font-size: 14px;
    font-weight: bold;
    margin-right: 12px;
  }
  .start { background: #16a34a; color: white; }
  .stop { background: #dc2626; color: white; }
  .status, .uptime {
    margin-top: 15px;
    padding: 8px 14px;
    border-radius: 12px;
    display: inline-block;
    font-weight: bold;
  }
  .running { background: rgba(34,197,94,0.15); color: #22c55e; }
  .stopped { background: rgba(239,68,68,0.15); color: #ef4444; }
  .unknown { background: rgba(148,163,184,0.2); color: #94a3b8; }
  .uptime { font-size: 14px; color: #f1f5f9; background: rgba(255,255,255,0.05); }
</style>
</head>
<body>

<header>
  <h1>üöÄ Drone Control Panel</h1>
</header>

<!-- Dashboard -->
<div id="dashboard">

  <!-- EoN Service -->
  <div class="card">
    <h2>üì° EoN Service (5001)</h2>
    <div class="btn-group">
      <button id="eon-start" class="btn start" onclick="sendCommand('http://localhost:5001/start', 'eon')">‚ñ∂ Start</button>
      <button id="eon-stop" class="btn stop" onclick="sendCommand('http://localhost:5001/stop', 'eon')">‚èπ Stop</button>
    </div>
    <div id="eon-status" class="status unknown">Checking...</div>
    <div id="eon-uptime" class="uptime">‚è± Uptime: 00:00:00</div>
  </div>

  <!-- MAVLINK Service -->
  <div class="card">
    <h2>üõ∞ MAVLINK Service (5002)</h2>
    <div class="btn-group">
      <button id="mav-start" class="btn start" onclick="sendCommand('http://localhost:5002/start', 'mav')">‚ñ∂ Start</button>
      <button id="mav-stop" class="btn stop" onclick="sendCommand('http://localhost:5002/stop', 'mav')">‚èπ Stop</button>
    </div>
    <div id="mav-status" class="status unknown">Checking...</div>
    <div id="mav-uptime" class="uptime">‚è± Uptime: 00:00:00</div>
  </div>
</div>

<script>
let uptimeStart = { eon: null, mav: null };

async function sendCommand(url, service) {
  const el = document.getElementById(service + "-status");
  try {
    const res = await fetch(url, { method: 'POST' });
    const data = await res.json();
    updateStatus(service, data.status);
  } catch {
    updateStatus(service, "stopped");
  }
}

function updateStatus(service, status) {
  const el = document.getElementById(service + "-status");
  const uptimeEl = document.getElementById(service + "-uptime");
  if (status.toLowerCase().includes("running") || status.toLowerCase().includes("started")) {
    el.textContent = "Running";
    el.className = "status running";
    if (!uptimeStart[service]) uptimeStart[service] = Date.now();
  } else if (status.toLowerCase().includes("stopped")) {
    el.textContent = "Stopped";
    el.className = "status stopped";
    uptimeStart[service] = null;
    uptimeEl.textContent = "‚è± Uptime: 00:00:00";
  } else {
    el.textContent = "Unknown";
    el.className = "status unknown";
  }
}

function formatTime(ms) {
  const totalSeconds = Math.floor(ms / 1000);
  const hrs = String(Math.floor(totalSeconds / 3600)).padStart(2, '0');
  const mins = String(Math.floor((totalSeconds % 3600) / 60)).padStart(2, '0');
  const secs = String(totalSeconds % 60).padStart(2, '0');
  return `${hrs}:${mins}:${secs}`;
}

function updateUptime() {
  for (const service of ["eon","mav"]) {
    const uptimeEl = document.getElementById(service + "-uptime");
    if (uptimeStart[service]) {
      uptimeEl.textContent = "‚è± Uptime: " + formatTime(Date.now() - uptimeStart[service]);
    }
  }
}

async function checkStatus() {
  try {
    const eonRes = await fetch("http://localhost:5001/uiStatus");
    updateStatus("eon", eonRes.ok ? (await eonRes.json()).status : "stopped");
  } catch { updateStatus("eon", "stopped"); }

  try {
    const mavRes = await fetch("http://localhost:5002/uiStatus");
    updateStatus("mav", mavRes.ok ? (await mavRes.json()).status : "stopped");
  } catch { updateStatus("mav", "stopped"); }
}

setInterval(checkStatus, 5000);
setInterval(updateUptime, 1000);
checkStatus();
</script>

</body>
</html>
